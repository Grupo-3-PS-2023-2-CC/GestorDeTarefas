<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/style.css">
    <title>Kanban</title>
</head>
<body>
    <header>
        <nav>
            <img src="LogoFocus2.webp" alt="Logo Focus">
            <input id="ativarBotaoAdicao" type="checkbox" style="visibility: hidden;"/>
            <button type="menu" id="botaoAdicao" value="+" onclick="ativarMenu()">
            <div id="traco1" class="traco"></div>
            <div id="traco2" class="traco"></div>
            <div id="traco3" class="traco"></div>
            </button>
        </nav>
            <!-- FORMULÁRIO ------------------------------------------------------------------------>
            <section id="adicionarAtividade" style="visibility: hidden;">
                <h1>Adicionar Atividade</h1>
                <form action="/criar" method="post">
                    <label for="nome">Tarefa:</label>
                    <input id="nome" name="nome" type="text">
            
                    <label for="descricao">Descrição:</label>
                    <input id="descricao" name="descricao" type="text">
            
                    <label for="estado">Seção:</label>
                    <select name="estado" id="estado">
                        <option value="A Fazer">A Fazer</option>
                        <option value="Fazendo">Fazendo</option>
                        <option value="Finalizado">Finalizado</option>
                    </select>
            
                    <label for="prioridade">Prioridade:</label>
                    <select name="prioridade" id="prioridade">
                        <option value="alta">Alta</option>
                        <option value="media">Média</option>
                        <option value="baixa">Baixa</option>
                    </select>
            
                    <label for="autor">Autor:</label>
                    <input id="autor" name="autor" type="text">
            
                    <label for="prazo">Prazo:</label>
                    <input id="prazo" name="prazo" type="date">
            
                    <button type="submit">Adicionar tarefa</button>
                </form>
            </section>
    </header>


    <!-- QUADRO ---------------------------------------------------------------------------->
    <main id="quadro">

        <% let colunas = ['A Fazer', 'Fazendo', 'Finalizado']%>
        <% let idsColunas = ['afazer', 'fazendo', 'finalizado']%>
        <%colunas.forEach((coluna, i)=>{%>
            <section class="coluna" id=<%=idsColunas[i]%>>
                <h1><%=coluna%></h1>
                <div class="atividades">
                    <div class="prioridade alta"></div>
                    <div class="prioridade media"></div>
                    <div class="prioridade baixa"></div>
                </div>
            </section>
        <%})%>

    </main>

    <!-- CARREGANDO DADOS ----------------------------------------------------------------->
    <script src="/script.js"></script>
    <script src="/dragAndDrop.js"></script>
    <script>
        
        let tarefas = '<%-JSON.stringify(tarefas)%>' //resgatando tarefas renderizadas.
        tarefas = JSON.parse(tarefas);

        tarefas.forEach(
            (tarefa)=>
            {
                //console.log(`Lendo tarefa `, tarefa);
                estadoFormatado = tarefa.estado.match(/\w+/gi).join('').toLowerCase();
                let coluna = document.querySelector(`#${estadoFormatado}`);
                let linha = coluna.querySelector(`.${tarefa.prioridade}`);
                let cor;
                switch(estadoFormatado)
                {
                    case "afazer":
                        cor = '#E53324';
                        break;
                    case "fazendo":
                        cor = '#FBE23E';
                        break;
                    case "finalizado":
                        cor = '#2F993D';
                        break;
                    default:
                        cor = 'purple';
                }
                linha.innerHTML += 
                `
                <div class="atividade" draggable="true">
                            <div class="tituloAtividade" style="background-color: ${cor};">${tarefa.nome}</div>
                            <div class="atributos-atividade-container">
                                <p class="descricao">
                                    ${tarefa.descricao}
                                </p>
                                <div class="data-container">
                                    <p class="data-rotulo">Prazo:</p>
                                    <p class="data">${new Date(tarefa.prazo).toLocaleDateString()}</p>
                                </div>
                                <div class="extra">
                                    <div class="autor-prioridade">
                                    <p class="autor">${tarefa.autor}</p>
                                    <p class="prioridade">${tarefa.prioridade}</p>
                                    </div>
                                    <div class="data-container">
                                        <p class="data-rotulo">Criada:</p>
                                        <p class="data">${new Date(tarefa.dataCriacao).toLocaleDateString()}</p>
                                    </div>
                                    <div class="data-container">
                                        <p class="data-rotulo">Modificada:</p>
                                        <p class="data">${new Date(tarefa.ultimaModificacao).toLocaleDateString()}</p>
                                </div>
                                </div>
                            </div>
                        </div>
                `;
            }
        )
    </script>
</body>
</html>